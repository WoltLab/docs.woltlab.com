
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://docs.woltlab.com/6.0/tutorial/series/part_5/">
      
      <link rel="icon" href="../../../assets/default.favicon.ico">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>Part 5 - WoltLab Suite Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.2505c338.min.css">
        
          
          
          <meta name="theme-color" content="#009485">
        
      
      

    
    
    
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#part-5-person-information" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
            
    <a href="https://www.woltlab.com">Back to <strong>woltlab.com</strong></a>

          </div>
          
        </aside>
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="WoltLab Suite Documentation" class="md-header__button md-logo" aria-label="WoltLab Suite Documentation" data-md-component="logo">
      
  <img src="../../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            WoltLab Suite Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Part 5
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/WoltLab/docs.woltlab.com/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="WoltLab Suite Documentation" class="md-nav__button md-logo" aria-label="WoltLab Suite Documentation" data-md-component="logo">
      
  <img src="../../../assets/logo.png" alt="logo">

    </a>
    WoltLab Suite Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/WoltLab/docs.woltlab.com/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../getting-started/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          PHP API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="PHP API" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          PHP API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../php/pages/" class="md-nav__link">
        Pages
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../php/database-objects/" class="md-nav__link">
        Database Objects
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../php/database-access/" class="md-nav__link">
        Database Access
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../php/exceptions/" class="md-nav__link">
        Exceptions
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_5" type="checkbox" id="__nav_2_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_5">
          API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_5">
          <span class="md-nav__icon md-icon"></span>
          API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_5_1" type="checkbox" id="__nav_2_5_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_5_1">
          Caches
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Caches" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_5_1">
          <span class="md-nav__icon md-icon"></span>
          Caches
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../php/api/caches/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../php/api/caches_persistent-caches/" class="md-nav__link">
        Persistent Caches
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../php/api/caches_runtime-caches/" class="md-nav__link">
        Runtime Caches
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../php/api/comments/" class="md-nav__link">
        Comments
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../php/api/cronjobs/" class="md-nav__link">
        Cronjobs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../php/api/events/" class="md-nav__link">
        Events
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_5_5" type="checkbox" id="__nav_2_5_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_5_5">
          Form Builder
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Form Builder" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_5_5">
          <span class="md-nav__icon md-icon"></span>
          Form Builder
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../php/api/form_builder/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../php/api/form_builder/structure/" class="md-nav__link">
        Structure
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../php/api/form_builder/form_fields/" class="md-nav__link">
        Fields
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../php/api/form_builder/validation_data/" class="md-nav__link">
        Validation and Data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../php/api/form_builder/dependencies/" class="md-nav__link">
        Dependencies
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../php/api/package_installation_plugins/" class="md-nav__link">
        Package Installation Plugins
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../php/api/user_activity_points/" class="md-nav__link">
        User Activity Points
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../php/api/user_notifications/" class="md-nav__link">
        User Notifications
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../php/api/sitemaps/" class="md-nav__link">
        Sitemaps
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../php/code-style/" class="md-nav__link">
        Code Style
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../php/apps/" class="md-nav__link">
        Apps
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../php/gdpr/" class="md-nav__link">
        GDPR
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Languages, Templates & CSS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Languages, Templates & CSS" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Languages, Templates & CSS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../view/languages/" class="md-nav__link">
        Languages
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../view/templates/" class="md-nav__link">
        Templates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../view/template-plugins/" class="md-nav__link">
        Template Plugins
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../view/css/" class="md-nav__link">
        CSS
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          TypeScript and JavaScript API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="TypeScript and JavaScript API" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          TypeScript and JavaScript API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../javascript/general-usage/" class="md-nav__link">
        General Usage
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../javascript/typescript/" class="md-nav__link">
        TypeScript
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3" type="checkbox" id="__nav_4_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_3">
          Components
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Components" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_3">
          <span class="md-nav__icon md-icon"></span>
          Components
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../javascript/components_confirmation/" class="md-nav__link">
        Confirmation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../javascript/components_dialog/" class="md-nav__link">
        Dialog
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_4" type="checkbox" id="__nav_4_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_4">
          New API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="New API" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_4">
          <span class="md-nav__icon md-icon"></span>
          New API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../javascript/new-api_writing-a-module/" class="md-nav__link">
        Writing a module
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../javascript/new-api_core/" class="md-nav__link">
        Core Functions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../javascript/new-api_dom/" class="md-nav__link">
        DOM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../javascript/new-api_events/" class="md-nav__link">
        Event Handling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../javascript/new-api_ajax/" class="md-nav__link">
        Ajax
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../javascript/new-api_dialogs/" class="md-nav__link">
        Dialogs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../javascript/new-api_browser/" class="md-nav__link">
        Browser and Screen Sizes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../javascript/new-api_ui/" class="md-nav__link">
        User Interface
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../javascript/legacy-api/" class="md-nav__link">
        Legacy API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../javascript/code-snippets/" class="md-nav__link">
        Code Snippets
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Package Components
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Package Components" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Package Components
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../package/package-xml/" class="md-nav__link">
        package.xml
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_2" type="checkbox" id="__nav_5_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5_2">
          PIPs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="PIPs" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_2">
          <span class="md-nav__icon md-icon"></span>
          PIPs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../package/pip/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../package/pip/acl-option/" class="md-nav__link">
        aclOption
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../package/pip/acp-menu/" class="md-nav__link">
        acpMenu
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../package/pip/acp-search-provider/" class="md-nav__link">
        acpSearchProvider
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../package/pip/acp-template/" class="md-nav__link">
        acpTemplate
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../package/pip/acp-template-delete/" class="md-nav__link">
        acpTemplateDelete
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../package/pip/bbcode/" class="md-nav__link">
        bbcode
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../package/pip/box/" class="md-nav__link">
        box
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../package/pip/clipboard-action/" class="md-nav__link">
        clipboardAction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../package/pip/core-object/" class="md-nav__link">
        coreObject
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../package/pip/cronjob/" class="md-nav__link">
        cronjob
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../package/pip/database/" class="md-nav__link">
        database
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../package/pip/event-listener/" class="md-nav__link">
        eventListener
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../package/pip/file/" class="md-nav__link">
        file
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../package/pip/file-delete/" class="md-nav__link">
        fileDelete
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../package/pip/language/" class="md-nav__link">
        language
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../package/pip/media-provider/" class="md-nav__link">
        mediaProvider
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../package/pip/menu/" class="md-nav__link">
        menu
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../package/pip/menu-item/" class="md-nav__link">
        menuItem
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../package/pip/object-type/" class="md-nav__link">
        objectType
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../package/pip/object-type-definition/" class="md-nav__link">
        objectTypeDefinition
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../package/pip/option/" class="md-nav__link">
        option
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../package/pip/page/" class="md-nav__link">
        page
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../package/pip/pip/" class="md-nav__link">
        pip
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../package/pip/script/" class="md-nav__link">
        script
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../package/pip/smiley/" class="md-nav__link">
        smiley
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../package/pip/sql/" class="md-nav__link">
        sql
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../package/pip/style/" class="md-nav__link">
        style
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../package/pip/template/" class="md-nav__link">
        template
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../package/pip/template-delete/" class="md-nav__link">
        templateDelete
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../package/pip/template-listener/" class="md-nav__link">
        templateListener
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../package/pip/user-group-option/" class="md-nav__link">
        userGroupOption
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../package/pip/user-menu/" class="md-nav__link">
        userMenu
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../package/pip/user-notification-event/" class="md-nav__link">
        userNotificationEvent
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../package/pip/user-option/" class="md-nav__link">
        userOption
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../package/pip/user-profile-menu/" class="md-nav__link">
        userProfileMenu
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../package/database-php-api/" class="md-nav__link">
        Database PHP API
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Migration
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Migration" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Migration
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_1" type="checkbox" id="__nav_6_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_1">
          From WoltLab Suite 5.5
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="From WoltLab Suite 5.5" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_1">
          <span class="md-nav__icon md-icon"></span>
          From WoltLab Suite 5.5
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../migration/wsc55/php/" class="md-nav__link">
        PHP API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../migration/wsc55/javascript/" class="md-nav__link">
        TypeScript and JavaScript
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../migration/wsc55/templates/" class="md-nav__link">
        Templates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../migration/wsc55/icons/" class="md-nav__link">
        Icons
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../migration/wsc55/dialogs/" class="md-nav__link">
        Dialogs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../migration/wsc55/libraries/" class="md-nav__link">
        Third Party Libraries
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../migration/wsc55/deprecations_removals/" class="md-nav__link">
        Deprecations and Removals
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_2" type="checkbox" id="__nav_6_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_2">
          From WoltLab Suite 5.4
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="From WoltLab Suite 5.4" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_2">
          <span class="md-nav__icon md-icon"></span>
          From WoltLab Suite 5.4
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../migration/wsc54/php/" class="md-nav__link">
        PHP API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../migration/wsc54/javascript/" class="md-nav__link">
        TypeScript and JavaScript
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../migration/wsc54/templates/" class="md-nav__link">
        Templates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../migration/wsc54/libraries/" class="md-nav__link">
        Third Party Libraries
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../migration/wsc54/deprecations_removals/" class="md-nav__link">
        Deprecations and Removals
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_3" type="checkbox" id="__nav_6_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_3">
          From WoltLab Suite 5.3
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="From WoltLab Suite 5.3" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_3">
          <span class="md-nav__icon md-icon"></span>
          From WoltLab Suite 5.3
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../migration/wsc53/php/" class="md-nav__link">
        PHP API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../migration/wsc53/session/" class="md-nav__link">
        Session Handling and Authentication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../migration/wsc53/javascript/" class="md-nav__link">
        TypeScript and JavaScript
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../migration/wsc53/templates/" class="md-nav__link">
        Templates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../migration/wsc53/libraries/" class="md-nav__link">
        Third Party Libraries
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_4" type="checkbox" id="__nav_6_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_4">
          From WoltLab Suite 5.2
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="From WoltLab Suite 5.2" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_4">
          <span class="md-nav__icon md-icon"></span>
          From WoltLab Suite 5.2
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../migration/wsc52/php/" class="md-nav__link">
        PHP API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../migration/wsc52/templates/" class="md-nav__link">
        Templates and Languages
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../migration/wsc52/libraries/" class="md-nav__link">
        Third Party Libraries
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_5" type="checkbox" id="__nav_6_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_5">
          From WoltLab Suite 3.1
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="From WoltLab Suite 3.1" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_5">
          <span class="md-nav__icon md-icon"></span>
          From WoltLab Suite 3.1
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../migration/wsc31/php/" class="md-nav__link">
        PHP API
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_6" type="checkbox" id="__nav_6_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_6">
          From WoltLab Suite 3.0
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="From WoltLab Suite 3.0" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_6">
          <span class="md-nav__icon md-icon"></span>
          From WoltLab Suite 3.0
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../migration/wsc30/php/" class="md-nav__link">
        PHP API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../migration/wsc30/javascript/" class="md-nav__link">
        JavaScript API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../migration/wsc30/templates/" class="md-nav__link">
        Templates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../migration/wsc30/css/" class="md-nav__link">
        CSS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../migration/wsc30/package/" class="md-nav__link">
        Package Components
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_7" type="checkbox" id="__nav_6_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_7">
          From WCF 2.1
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="From WCF 2.1" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_7">
          <span class="md-nav__icon md-icon"></span>
          From WCF 2.1
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../migration/wcf21/php/" class="md-nav__link">
        PHP API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../migration/wcf21/templates/" class="md-nav__link">
        Templates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../migration/wcf21/css/" class="md-nav__link">
        CSS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../migration/wcf21/package/" class="md-nav__link">
        Package Components
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          Tutorials
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tutorials" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_1" type="checkbox" id="__nav_7_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_7_1">
          Tutorial Series
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tutorial Series" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_1">
          <span class="md-nav__icon md-icon"></span>
          Tutorial Series
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../part_1/" class="md-nav__link">
        Part 1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../part_2/" class="md-nav__link">
        Part 2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../part_3/" class="md-nav__link">
        Part 3
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../part_4/" class="md-nav__link">
        Part 4
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Part 5
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Part 5
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#package-functionality" class="md-nav__link">
    Package Functionality
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#used-components" class="md-nav__link">
    Used Components
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#package-structure" class="md-nav__link">
    Package Structure
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#miscellaneous" class="md-nav__link">
    Miscellaneous
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#person-information-model" class="md-nav__link">
    Person Information Model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#listing-and-deleting-person-information" class="md-nav__link">
    Listing and Deleting Person Information
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-and-editing-person-information" class="md-nav__link">
    Creating and Editing Person Information
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rebuild-data-worker" class="md-nav__link">
    Rebuild Data Worker
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#username-and-ip-address-event-listeners" class="md-nav__link">
    Username and IP Address Event Listeners
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../part_6/" class="md-nav__link">
        Part 6
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#package-functionality" class="md-nav__link">
    Package Functionality
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#used-components" class="md-nav__link">
    Used Components
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#package-structure" class="md-nav__link">
    Package Structure
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#miscellaneous" class="md-nav__link">
    Miscellaneous
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#person-information-model" class="md-nav__link">
    Person Information Model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#listing-and-deleting-person-information" class="md-nav__link">
    Listing and Deleting Person Information
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-and-editing-person-information" class="md-nav__link">
    Creating and Editing Person Information
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rebuild-data-worker" class="md-nav__link">
    Rebuild Data Worker
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#username-and-ip-address-event-listeners" class="md-nav__link">
    Username and IP Address Event Listeners
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/WoltLab/docs.woltlab.com/edit/6.0/docs/tutorial/series/part_5.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="part-5-person-information">Part 5: Person Information<a class="headerlink" href="#part-5-person-information" title="Permanent link">#</a></h1>
<p>This part of our tutorial series lays the foundation for future parts in which we will be using additional APIs, which we have not used in this series yet.
To make use of those APIs, we need content generated by users in the frontend.</p>
<h2 id="package-functionality">Package Functionality<a class="headerlink" href="#package-functionality" title="Permanent link">#</a></h2>
<p>In addition to the existing functions from <a href="../part_4/">part 4</a>, the package will provide the following functionality after this part of the tutorial:</p>
<ul>
<li>Users are able to add information on the people in the frontend.</li>
<li>Users are able to edit and delete the pieces of information they added.</li>
<li>Moderators are able to edit and delete all pieces of information.</li>
</ul>
<h2 id="used-components">Used Components<a class="headerlink" href="#used-components" title="Permanent link">#</a></h2>
<p>In addition to the components used in previous parts, we will use the <a href="../../../php/api/form_builder/overview/">form builder API</a> to create forms shown in dialogs instead of dedicated pages and we will, for the first time, add <a href="../../../javascript/typescript/">TypeScript code</a>.</p>
<h2 id="package-structure">Package Structure<a class="headerlink" href="#package-structure" title="Permanent link">#</a></h2>
<p>The package will have the following file structure <em>excluding</em> unchanged files from previous parts:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span></pre></div></td><td class="code"><div><pre><span></span><code> files
    acp
       database
           install_com.woltlab.wcf.people.php
    js
       WoltLabSuite
           Core
               Controller
                   Person.js
    lib
        data
           person
               Person.class.php
               information
                   PersonInformation.class.php
                   PersonInformationAction.class.php
                   PersonInformationEditor.class.php
                   PersonInformationList.class.php
        system
            worker
                PersonRebuildDataWorker.class.php
 language
    de.xml
    en.xml
 objectType.xml
 templates
    person.tpl
    personList.tpl
 ts
    WoltLabSuite
        Core
            Controller
                Person.ts
 userGroupOption.xml
</code></pre></div></td></tr></table></div>
<p>For all changes, please refer to the <a href="https://github.com/WoltLab/docs.woltlab.com/tree/6.0/snippets/tutorial/tutorial-series/part-5">source code on GitHub</a>.</p>
<h2 id="miscellaneous">Miscellaneous<a class="headerlink" href="#miscellaneous" title="Permanent link">#</a></h2>
<p>Before we focus on the main aspects of this part, we mention some minor aspects that will be used later on:</p>
<ul>
<li>Several new user group options and the relevant language items have been added related to creating, editing, and deleting information:<ul>
<li><code>mod.person.canEditInformation</code> and <code>mod.person.canDeleteInformation</code> are moderative permissions to edit and delete any piece of information, regardless of who created it.</li>
<li><code>user.person.canAddInformation</code> is the permission for users to add new pieces of information.</li>
<li><code>user.person.canEditInformation</code> and <code>user.person.canDeleteInformation</code> are the user permissions to edit and the piece of information they created.</li>
</ul>
</li>
<li>The actual information text will be entered via a WYSIWYG editor, which requires an object type of the definition <code>com.woltlab.wcf.message</code>: <code>com.woltlab.wcf.people.information</code>.</li>
<li><code>personList.tpl</code> has been adjusted to show the number of pieces of information in the person statistics section.</li>
<li>We have not updated the person list box to also support sorting by the number of pieces of information added for each person.</li>
</ul>
<h2 id="person-information-model">Person Information Model<a class="headerlink" href="#person-information-model" title="Permanent link">#</a></h2>
<p>The PHP file with the database layout has been updated as follows:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">files/acp/database/install_com.woltlab.wcf.people.php <a class="codeBoxTitleGitHubLink" href="https://github.com/WoltLab/docs.woltlab.com/tree/6.0/snippets/tutorial/tutorial-series/part-5/files/acp/database/install_com.woltlab.wcf.people.php" title="View on GitHub"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8v2m9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1 0 1.71-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5Z"/></svg></span></a></span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">use</span> <span class="nx">wcf\system\database\table\column\DefaultTrueBooleanDatabaseTableColumn</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">wcf\system\database\table\column\IntDatabaseTableColumn</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">wcf\system\database\table\column\NotNullInt10DatabaseTableColumn</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">wcf\system\database\table\column\NotNullVarchar255DatabaseTableColumn</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">wcf\system\database\table\column\ObjectIdDatabaseTableColumn</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">wcf\system\database\table\column\SmallintDatabaseTableColumn</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">wcf\system\database\table\column\TextDatabaseTableColumn</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">wcf\system\database\table\column\VarcharDatabaseTableColumn</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">wcf\system\database\table\DatabaseTable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">wcf\system\database\table\index\DatabaseTableForeignKey</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">wcf\system\database\table\index\DatabaseTablePrimaryIndex</span><span class="p">;</span>

<span class="k">return</span> <span class="p">[</span>
    <span class="nx">DatabaseTable</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;wcf1_person&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">columns</span><span class="p">([</span>
            <span class="nx">ObjectIdDatabaseTableColumn</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;personID&#39;</span><span class="p">),</span>
            <span class="nx">NotNullVarchar255DatabaseTableColumn</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;firstName&#39;</span><span class="p">),</span>
            <span class="nx">NotNullVarchar255DatabaseTableColumn</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;lastName&#39;</span><span class="p">),</span>
            <span class="nx">NotNullInt10DatabaseTableColumn</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;informationCount&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">defaultValue</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
            <span class="nx">SmallintDatabaseTableColumn</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;comments&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">length</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">notNull</span><span class="p">()</span>
                <span class="o">-&gt;</span><span class="na">defaultValue</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
            <span class="nx">DefaultTrueBooleanDatabaseTableColumn</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;enableComments&#39;</span><span class="p">),</span>
        <span class="p">])</span>
        <span class="o">-&gt;</span><span class="na">indices</span><span class="p">([</span>
            <span class="nx">DatabaseTablePrimaryIndex</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
                <span class="o">-&gt;</span><span class="na">columns</span><span class="p">([</span><span class="s1">&#39;personID&#39;</span><span class="p">]),</span>
        <span class="p">]),</span>

    <span class="nx">DatabaseTable</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;wcf1_person_information&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">columns</span><span class="p">([</span>
            <span class="nx">ObjectIdDatabaseTableColumn</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;informationID&#39;</span><span class="p">),</span>
            <span class="nx">NotNullInt10DatabaseTableColumn</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;personID&#39;</span><span class="p">),</span>
            <span class="nx">TextDatabaseTableColumn</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;information&#39;</span><span class="p">),</span>
            <span class="nx">IntDatabaseTableColumn</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;userID&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">length</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
            <span class="nx">NotNullVarchar255DatabaseTableColumn</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">),</span>
            <span class="nx">VarcharDatabaseTableColumn</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;ipAddress&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">length</span><span class="p">(</span><span class="mi">39</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">notNull</span><span class="p">(</span><span class="k">true</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">defaultValue</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">),</span>
            <span class="nx">NotNullInt10DatabaseTableColumn</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">),</span>
        <span class="p">])</span>
        <span class="o">-&gt;</span><span class="na">indices</span><span class="p">([</span>
            <span class="nx">DatabaseTablePrimaryIndex</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
                <span class="o">-&gt;</span><span class="na">columns</span><span class="p">([</span><span class="s1">&#39;informationID&#39;</span><span class="p">]),</span>
        <span class="p">])</span>
        <span class="o">-&gt;</span><span class="na">foreignKeys</span><span class="p">([</span>
            <span class="nx">DatabaseTableForeignKey</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
                <span class="o">-&gt;</span><span class="na">columns</span><span class="p">([</span><span class="s1">&#39;personID&#39;</span><span class="p">])</span>
                <span class="o">-&gt;</span><span class="na">referencedTable</span><span class="p">(</span><span class="s1">&#39;wcf1_person&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">referencedColumns</span><span class="p">([</span><span class="s1">&#39;personID&#39;</span><span class="p">])</span>
                <span class="o">-&gt;</span><span class="na">onDelete</span><span class="p">(</span><span class="s1">&#39;CASCADE&#39;</span><span class="p">),</span>
            <span class="nx">DatabaseTableForeignKey</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
                <span class="o">-&gt;</span><span class="na">columns</span><span class="p">([</span><span class="s1">&#39;userID&#39;</span><span class="p">])</span>
                <span class="o">-&gt;</span><span class="na">referencedTable</span><span class="p">(</span><span class="s1">&#39;wcf1_user&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">referencedColumns</span><span class="p">([</span><span class="s1">&#39;userID&#39;</span><span class="p">])</span>
                <span class="o">-&gt;</span><span class="na">onDelete</span><span class="p">(</span><span class="s1">&#39;SET NULL&#39;</span><span class="p">),</span>
        <span class="p">]),</span>
<span class="p">];</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>The number of pieces of information per person is tracked via the new <code>informationCount</code> column.</li>
<li>The <code>wcf1_person_information</code> table has been added for the <code>PersonInformation</code> model.
  The meaning of the different columns is explained in the property documentation part of <code>PersonInformation</code>'s documentation (see below).
  The two foreign keys ensure that if a person is deleted, all of their information is also deleted, and that if a user is deleted, the <code>userID</code> column is set to <code>NULL</code>.</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">files/lib/data/person/information/PersonInformation.class.php <a class="codeBoxTitleGitHubLink" href="https://github.com/WoltLab/docs.woltlab.com/tree/6.0/snippets/tutorial/tutorial-series/part-5/files/lib/data/person/information/PersonInformation.class.php" title="View on GitHub"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8v2m9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1 0 1.71-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5Z"/></svg></span></a></span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">wcf\data\person\information</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">wcf\data\DatabaseObject</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">wcf\data\person\Person</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">wcf\data\user\UserProfile</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">wcf\system\cache\runtime\PersonRuntimeCache</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">wcf\system\cache\runtime\UserProfileRuntimeCache</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">wcf\system\html\output\HtmlOutputProcessor</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">wcf\system\WCF</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * Represents a piece of information for a person.</span>
<span class="sd"> *</span>
<span class="sd"> * @author  Matthias Schmidt</span>
<span class="sd"> * @copyright   2001-2021 WoltLab GmbH</span>
<span class="sd"> * @license GNU Lesser General Public License &lt;http://opensource.org/licenses/lgpl-license.php&gt;</span>
<span class="sd"> * @package WoltLabSuite\Core\Data\Person\Information</span>
<span class="sd"> *</span>
<span class="sd"> * @property-read   int         $informationID  unique id of the information</span>
<span class="sd"> * @property-read   int         $personID       id of the person the information belongs to</span>
<span class="sd"> * @property-read   string      $information    information text</span>
<span class="sd"> * @property-read   int|null    $userID         id of the user who added the information or `null` if the user no longer exists</span>
<span class="sd"> * @property-read   string      $username       name of the user who added the information</span>
<span class="sd"> * @property-read   int         $time           timestamp at which the information was created</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">PersonInformation</span> <span class="k">extends</span> <span class="nx">DatabaseObject</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Returns `true` if the active user can delete this piece of information and `false` otherwise.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">canDelete</span><span class="p">()</span><span class="o">:</span> <span class="nx">bool</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="nx">WCF</span><span class="o">::</span><span class="na">getUser</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">userID</span>
            <span class="o">&amp;&amp;</span> <span class="nx">WCF</span><span class="o">::</span><span class="na">getUser</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">userID</span> <span class="o">==</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">userID</span>
            <span class="o">&amp;&amp;</span> <span class="nx">WCF</span><span class="o">::</span><span class="na">getSession</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getPermission</span><span class="p">(</span><span class="s1">&#39;user.person.canDeleteInformation&#39;</span><span class="p">)</span>
        <span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">WCF</span><span class="o">::</span><span class="na">getSession</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getPermission</span><span class="p">(</span><span class="s1">&#39;mod.person.canDeleteInformation&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Returns `true` if the active user can edit this piece of information and `false` otherwise.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">canEdit</span><span class="p">()</span><span class="o">:</span> <span class="nx">bool</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="nx">WCF</span><span class="o">::</span><span class="na">getUser</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">userID</span>
            <span class="o">&amp;&amp;</span> <span class="nx">WCF</span><span class="o">::</span><span class="na">getUser</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">userID</span> <span class="o">==</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">userID</span>
            <span class="o">&amp;&amp;</span> <span class="nx">WCF</span><span class="o">::</span><span class="na">getSession</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getPermission</span><span class="p">(</span><span class="s1">&#39;user.person.canEditInformation&#39;</span><span class="p">)</span>
        <span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">WCF</span><span class="o">::</span><span class="na">getSession</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getPermission</span><span class="p">(</span><span class="s1">&#39;mod.person.canEditInformation&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Returns the formatted information.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getFormattedInformation</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="nv">$processor</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HtmlOutputProcessor</span><span class="p">();</span>
        <span class="nv">$processor</span><span class="o">-&gt;</span><span class="na">process</span><span class="p">(</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">information</span><span class="p">,</span>
            <span class="s1">&#39;com.woltlab.wcf.people.information&#39;</span><span class="p">,</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">informationID</span>
        <span class="p">);</span>

        <span class="k">return</span> <span class="nv">$processor</span><span class="o">-&gt;</span><span class="na">getHtml</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Returns the person the information belongs to.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getPerson</span><span class="p">()</span><span class="o">:</span> <span class="nx">Person</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">PersonRuntimeCache</span><span class="o">::</span><span class="na">getInstance</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getObject</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">personID</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Returns the user profile of the user who added the information.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getUserProfile</span><span class="p">()</span><span class="o">:</span> <span class="nx">UserProfile</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">userID</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">UserProfileRuntimeCache</span><span class="o">::</span><span class="na">getInstance</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getObject</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">userID</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">UserProfile</span><span class="o">::</span><span class="na">getGuestUserProfile</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">username</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><code>PersonInformation</code> provides two methods, <code>canDelete()</code> and <code>canEdit()</code>, to check whether the active user can delete or edit a specific piece of information.
In both cases, it is checked if the current user has created the relevant piece of information to check the user-specific permissions or to fall back to the moderator-specific permissions.</p>
<p>There also two getter methods for the person, the piece of information belongs to (<code>getPerson()</code>), and for the user profile of the user who created the information (<code>getUserProfile()</code>).
In both cases, we use runtime caches, though in <code>getUserProfile()</code>, we also have to consider the case of the user who created the information being deleted, i.e. <code>userID</code> being <code>null</code>.
For such a case, we also save the name of the user who created the information in <code>username</code>, so that we can return a guest user profile object in this case.
The most interesting method is <code>getFormattedInformation()</code>, which returns the HTML code of the information text meant for output.
To generate such an output, <code>HtmlOutputProcessor::process()</code> is used and here is where we first use the associated message object type <code>com.woltlab.wcf.people.information</code> mentioned <a href="#miscellaneous">before</a>.</p>
<p>While <code>PersonInformationEditor</code> is simply the default implementation and thus not explicitly shown here, <code>PersonInformationList::readObjects()</code> caches the relevant ids of the associated people and users who created the pieces of information using runtime caches:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">files/lib/data/person/information/PersonInformationList.class.php <a class="codeBoxTitleGitHubLink" href="https://github.com/WoltLab/docs.woltlab.com/tree/6.0/snippets/tutorial/tutorial-series/part-5/files/lib/data/person/information/PersonInformationList.class.php" title="View on GitHub"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8v2m9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1 0 1.71-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5Z"/></svg></span></a></span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">wcf\data\person\information</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">wcf\data\DatabaseObjectList</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">wcf\system\cache\runtime\PersonRuntimeCache</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">wcf\system\cache\runtime\UserProfileRuntimeCache</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * Represents a list of person information.</span>
<span class="sd"> *</span>
<span class="sd"> * @author  Matthias Schmidt</span>
<span class="sd"> * @copyright   2001-2021 WoltLab GmbH</span>
<span class="sd"> * @license GNU Lesser General Public License &lt;http://opensource.org/licenses/lgpl-license.php&gt;</span>
<span class="sd"> * @package WoltLabSuite\Core\Data\PersonInformation</span>
<span class="sd"> *</span>
<span class="sd"> * @method      PersonInformation       current()</span>
<span class="sd"> * @method      PersonInformation[]     getObjects()</span>
<span class="sd"> * @method      PersonInformation|null  search($objectID)</span>
<span class="sd"> * @property    PersonInformation[]     $objects</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">PersonInformationList</span> <span class="k">extends</span> <span class="nx">DatabaseObjectList</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">readObjects</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">readObjects</span><span class="p">();</span>

        <span class="nx">UserProfileRuntimeCache</span><span class="o">::</span><span class="na">getInstance</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">cacheObjectIDs</span><span class="p">(</span><span class="nx">\array_unique</span><span class="p">(</span><span class="nx">\array_filter</span><span class="p">(</span><span class="nx">\array_column</span><span class="p">(</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">objects</span><span class="p">,</span>
            <span class="s1">&#39;userID&#39;</span>
        <span class="p">))));</span>
        <span class="nx">PersonRuntimeCache</span><span class="o">::</span><span class="na">getInstance</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">cacheObjectIDs</span><span class="p">(</span><span class="nx">\array_unique</span><span class="p">(</span><span class="nx">\array_column</span><span class="p">(</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">objects</span><span class="p">,</span>
            <span class="s1">&#39;personID&#39;</span>
        <span class="p">)));</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="listing-and-deleting-person-information">Listing and Deleting Person Information<a class="headerlink" href="#listing-and-deleting-person-information" title="Permanent link">#</a></h2>
<p>The <code>person.tpl</code> template has been updated to include a block for listing the information at the beginning:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">templates/person.tpl <a class="codeBoxTitleGitHubLink" href="https://github.com/WoltLab/docs.woltlab.com/tree/6.0/snippets/tutorial/tutorial-series/part-5/templates/person.tpl" title="View on GitHub"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8v2m9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1 0 1.71-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5Z"/></svg></span></a></span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="cp">{</span><span class="nf">capture</span> <span class="na">assign</span><span class="o">=</span><span class="s1">&#39;pageTitle&#39;</span><span class="cp">}{</span><span class="nv">$person</span><span class="cp">}</span><span class="x"> - </span><span class="cp">{</span><span class="nf">lang</span><span class="cp">}</span><span class="x">wcf.person.list</span><span class="cp">{</span><span class="nf">/lang</span><span class="cp">}{</span><span class="nf">/capture</span><span class="cp">}</span><span class="x"></span>

<span class="cp">{</span><span class="nf">capture</span> <span class="na">assign</span><span class="o">=</span><span class="s1">&#39;contentTitle&#39;</span><span class="cp">}{</span><span class="nv">$person</span><span class="cp">}{</span><span class="nf">/capture</span><span class="cp">}</span><span class="x"></span>

<span class="cp">{</span><span class="nf">include</span> <span class="na">file</span><span class="o">=</span><span class="s1">&#39;header&#39;</span><span class="cp">}</span><span class="x"></span>

<span class="cp">{</span><span class="nf">if</span> <span class="nv">$person</span><span class="o">-&gt;</span><span class="na">informationCount</span> <span class="o">||</span> <span class="nv">$__wcf</span><span class="o">-&gt;</span><span class="na">session</span><span class="o">-&gt;</span><span class="na">getPermission</span><span class="o">(</span><span class="s1">&#39;user.person.canAddInformation&#39;</span><span class="o">)</span><span class="cp">}</span><span class="x"></span>
<span class="x">    &lt;section class=&quot;section sectionContainerList&quot;&gt;</span>
<span class="x">        &lt;header class=&quot;sectionHeader&quot;&gt;</span>
<span class="x">            &lt;h2 class=&quot;sectionTitle&quot;&gt;</span>
<span class="x">                </span><span class="cp">{</span><span class="nf">lang</span><span class="cp">}</span><span class="x">wcf.person.information.list</span><span class="cp">{</span><span class="nf">/lang</span><span class="cp">}</span><span class="x"></span>
<span class="x">                </span><span class="cp">{</span><span class="nf">if</span> <span class="nv">$person</span><span class="o">-&gt;</span><span class="na">informationCount</span><span class="cp">}</span><span class="x"></span>
<span class="x">                    &lt;span class=&quot;badge&quot;&gt;</span><span class="cp">{</span><span class="err">#</span><span class="nv">$person</span><span class="o">-&gt;</span><span class="na">informationCount</span><span class="cp">}</span><span class="x">&lt;/span&gt;</span>
<span class="x">                </span><span class="cp">{</span><span class="nf">/if</span><span class="cp">}</span><span class="x"></span>
<span class="x">            &lt;/h2&gt;</span>
<span class="x">        &lt;/header&gt;</span>

<span class="x">        &lt;ul class=&quot;commentList containerList personInformationList jsObjectActionContainer&quot; </span><span class="cp">{</span><span class="c">*</span>
<span class="c">            *</span><span class="cp">}</span><span class="x">data-object-action-class-name=&quot;wcf\data\person\information\PersonInformationAction&quot;</span><span class="cp">{</span><span class="c">*</span>
<span class="c">        *</span><span class="cp">}</span><span class="x">&gt;</span>
<span class="x">            </span><span class="cp">{</span><span class="nf">if</span> <span class="nv">$__wcf</span><span class="o">-&gt;</span><span class="na">session</span><span class="o">-&gt;</span><span class="na">getPermission</span><span class="o">(</span><span class="s1">&#39;user.person.canAddInformation&#39;</span><span class="o">)</span><span class="cp">}</span><span class="x"></span>
<span class="x">                &lt;li class=&quot;containerListButtonGroup&quot;&gt;</span>
<span class="x">                    &lt;ul class=&quot;buttonGroup&quot;&gt;</span>
<span class="x">                        &lt;li&gt;</span>
<span class="x">                            &lt;a href=&quot;#&quot; class=&quot;button&quot; id=&quot;personInformationAddButton&quot;&gt;</span>
<span class="x">                                &lt;span class=&quot;icon icon16 fa-plus&quot;&gt;&lt;/span&gt;</span>
<span class="x">                                &lt;span&gt;</span><span class="cp">{</span><span class="nf">lang</span><span class="cp">}</span><span class="x">wcf.person.information.add</span><span class="cp">{</span><span class="nf">/lang</span><span class="cp">}</span><span class="x">&lt;/span&gt;</span>
<span class="x">                            &lt;/a&gt;</span>
<span class="x">                        &lt;/li&gt;</span>
<span class="x">                    &lt;/ul&gt;</span>
<span class="x">                &lt;/li&gt;</span>
<span class="x">            </span><span class="cp">{</span><span class="nf">/if</span><span class="cp">}</span><span class="x"></span>

<span class="x">            </span><span class="cp">{</span><span class="nf">foreach</span> <span class="na">from</span><span class="o">=</span><span class="nv">$person</span><span class="o">-&gt;</span><span class="na">getInformation</span><span class="o">()</span> <span class="na">item</span><span class="o">=</span><span class="nv">$information</span><span class="cp">}</span><span class="x"></span>
<span class="x">                &lt;li class=&quot;comment personInformation jsObjectActionObject&quot; data-object-id=&quot;</span><span class="cp">{</span><span class="o">@</span><span class="nv">$information</span><span class="o">-&gt;</span><span class="na">getObjectID</span><span class="o">()</span><span class="cp">}</span><span class="x">&quot;&gt;</span>
<span class="x">                    &lt;div class=&quot;box48</span><span class="cp">{</span><span class="nf">if</span> <span class="nv">$__wcf</span><span class="o">-&gt;</span><span class="na">getUserProfileHandler</span><span class="o">()-&gt;</span><span class="na">isIgnoredUser</span><span class="o">(</span><span class="nv">$information</span><span class="o">-&gt;</span><span class="na">userID</span><span class="o">,</span> <span class="m">2</span><span class="o">)</span><span class="cp">}</span><span class="x"> ignoredUserContent</span><span class="cp">{</span><span class="nf">/if</span><span class="cp">}</span><span class="x">&quot;&gt;</span>
<span class="x">                        </span><span class="cp">{</span><span class="nf">user</span> <span class="na">object</span><span class="o">=</span><span class="nv">$information</span><span class="o">-&gt;</span><span class="na">getUserProfile</span><span class="o">()</span> <span class="na">type</span><span class="o">=</span><span class="s1">&#39;avatar48&#39;</span> <span class="na">ariaHidden</span><span class="o">=</span><span class="s1">&#39;true&#39;</span> <span class="na">tabindex</span><span class="o">=</span><span class="s1">&#39;-1&#39;</span><span class="cp">}</span><span class="x"></span>

<span class="x">                        &lt;div class=&quot;commentContentContainer&quot;&gt;</span>
<span class="x">                            &lt;div class=&quot;commentContent&quot;&gt;</span>
<span class="x">                                &lt;div class=&quot;containerHeadline&quot;&gt;</span>
<span class="x">                                    &lt;h3&gt;</span>
<span class="x">                                        </span><span class="cp">{</span><span class="nf">if</span> <span class="nv">$information</span><span class="o">-&gt;</span><span class="na">userID</span><span class="cp">}</span><span class="x"></span>
<span class="x">                                            </span><span class="cp">{</span><span class="nf">user</span> <span class="na">object</span><span class="o">=</span><span class="nv">$information</span><span class="o">-&gt;</span><span class="na">getUserProfile</span><span class="o">()</span><span class="cp">}</span><span class="x"></span>
<span class="x">                                        </span><span class="cp">{</span><span class="nf">else</span><span class="cp">}</span><span class="x"></span>
<span class="x">                                            &lt;span&gt;</span><span class="cp">{</span><span class="nv">$information</span><span class="o">-&gt;</span><span class="na">username</span><span class="cp">}</span><span class="x">&lt;/span&gt;</span>
<span class="x">                                        </span><span class="cp">{</span><span class="nf">/if</span><span class="cp">}</span><span class="x"></span>

<span class="x">                                        &lt;small class=&quot;separatorLeft&quot;&gt;</span><span class="cp">{</span><span class="o">@</span><span class="nv">$information</span><span class="o">-&gt;</span><span class="na">time</span><span class="o">|</span><span class="na">time</span><span class="cp">}</span><span class="x">&lt;/small&gt;</span>
<span class="x">                                    &lt;/h3&gt;</span>
<span class="x">                                &lt;/div&gt;</span>

<span class="x">                                &lt;div class=&quot;htmlContent userMessage&quot; id=&quot;personInformation</span><span class="cp">{</span><span class="o">@</span><span class="nv">$information</span><span class="o">-&gt;</span><span class="na">getObjectID</span><span class="o">()</span><span class="cp">}</span><span class="x">&quot;&gt;</span>
<span class="x">                                    </span><span class="cp">{</span><span class="o">@</span><span class="nv">$information</span><span class="o">-&gt;</span><span class="na">getFormattedInformation</span><span class="o">()</span><span class="cp">}</span><span class="x"></span>
<span class="x">                                &lt;/div&gt;</span>

<span class="x">                                &lt;nav class=&quot;jsMobileNavigation buttonGroupNavigation&quot;&gt;</span>
<span class="x">                                    &lt;ul class=&quot;buttonList iconList&quot;&gt;</span>
<span class="x">                                        </span><span class="cp">{</span><span class="nf">if</span> <span class="nv">$information</span><span class="o">-&gt;</span><span class="na">canEdit</span><span class="o">()</span><span class="cp">}</span><span class="x"></span>
<span class="x">                                            &lt;li class=&quot;jsOnly&quot;&gt;</span>
<span class="x">                                                &lt;a href=&quot;#&quot; title=&quot;</span><span class="cp">{</span><span class="nf">lang</span><span class="cp">}</span><span class="x">wcf.global.button.edit</span><span class="cp">{</span><span class="nf">/lang</span><span class="cp">}</span><span class="x">&quot; class=&quot;jsEditInformation jsTooltip&quot;&gt;</span>
<span class="x">                                                    &lt;span class=&quot;icon icon16 fa-pencil&quot;&gt;&lt;/span&gt;</span>
<span class="x">                                                    &lt;span class=&quot;invisible&quot;&gt;</span><span class="cp">{</span><span class="nf">lang</span><span class="cp">}</span><span class="x">wcf.global.button.edit</span><span class="cp">{</span><span class="nf">/lang</span><span class="cp">}</span><span class="x">&lt;/span&gt;</span>
<span class="x">                                                &lt;/a&gt;</span>
<span class="x">                                            &lt;/li&gt;</span>
<span class="x">                                        </span><span class="cp">{</span><span class="nf">/if</span><span class="cp">}</span><span class="x"></span>
<span class="x">                                        </span><span class="cp">{</span><span class="nf">if</span> <span class="nv">$information</span><span class="o">-&gt;</span><span class="na">canDelete</span><span class="o">()</span><span class="cp">}</span><span class="x"></span>
<span class="x">                                            &lt;li class=&quot;jsOnly&quot;&gt;</span>
<span class="x">                                                &lt;a href=&quot;#&quot; title=&quot;</span><span class="cp">{</span><span class="nf">lang</span><span class="cp">}</span><span class="x">wcf.global.button.delete</span><span class="cp">{</span><span class="nf">/lang</span><span class="cp">}</span><span class="x">&quot; class=&quot;jsObjectAction jsTooltip&quot; data-object-action=&quot;delete&quot; data-confirm-message=&quot;</span><span class="cp">{</span><span class="nf">lang</span><span class="cp">}</span><span class="x">wcf.person.information.delete.confirmMessage</span><span class="cp">{</span><span class="nf">/lang</span><span class="cp">}</span><span class="x">&quot;&gt;</span>
<span class="x">                                                    &lt;span class=&quot;icon icon16 fa-times&quot;&gt;&lt;/span&gt;</span>
<span class="x">                                                    &lt;span class=&quot;invisible&quot;&gt;</span><span class="cp">{</span><span class="nf">lang</span><span class="cp">}</span><span class="x">wcf.global.button.edit</span><span class="cp">{</span><span class="nf">/lang</span><span class="cp">}</span><span class="x">&lt;/span&gt;</span>
<span class="x">                                                &lt;/a&gt;</span>
<span class="x">                                            &lt;/li&gt;</span>
<span class="x">                                        </span><span class="cp">{</span><span class="nf">/if</span><span class="cp">}</span><span class="x"></span>

<span class="x">                                        </span><span class="cp">{</span><span class="nf">event</span> <span class="na">name</span><span class="o">=</span><span class="s1">&#39;informationOptions&#39;</span><span class="cp">}</span><span class="x"></span>
<span class="x">                                    &lt;/ul&gt;</span>
<span class="x">                                &lt;/nav&gt;</span>
<span class="x">                            &lt;/div&gt;</span>
<span class="x">                        &lt;/div&gt;</span>
<span class="x">                    &lt;/div&gt;</span>
<span class="x">                &lt;/li&gt;</span>
<span class="x">            </span><span class="cp">{</span><span class="nf">/foreach</span><span class="cp">}</span><span class="x"></span>
<span class="x">        &lt;/ul&gt;</span>
<span class="x">    &lt;/section&gt;</span>
<span class="cp">{</span><span class="nf">/if</span><span class="cp">}</span><span class="x"></span>

<span class="cp">{</span><span class="nf">if</span> <span class="nv">$person</span><span class="o">-&gt;</span><span class="na">enableComments</span><span class="cp">}</span><span class="x"></span>
<span class="x">    </span><span class="cp">{</span><span class="nf">if</span> <span class="nv">$commentList</span><span class="o">|</span><span class="na">count</span> <span class="o">||</span> <span class="nv">$commentCanAdd</span><span class="cp">}</span><span class="x"></span>
<span class="x">        &lt;section id=&quot;comments&quot; class=&quot;section sectionContainerList&quot;&gt;</span>
<span class="x">            &lt;header class=&quot;sectionHeader&quot;&gt;</span>
<span class="x">                &lt;h2 class=&quot;sectionTitle&quot;&gt;</span>
<span class="x">                    </span><span class="cp">{</span><span class="nf">lang</span><span class="cp">}</span><span class="x">wcf.person.comments</span><span class="cp">{</span><span class="nf">/lang</span><span class="cp">}</span><span class="x"></span>
<span class="x">                    </span><span class="cp">{</span><span class="nf">if</span> <span class="nv">$person</span><span class="o">-&gt;</span><span class="na">comments</span><span class="cp">}</span><span class="x">&lt;span class=&quot;badge&quot;&gt;</span><span class="cp">{</span><span class="err">#</span><span class="nv">$person</span><span class="o">-&gt;</span><span class="na">comments</span><span class="cp">}</span><span class="x">&lt;/span&gt;</span><span class="cp">{</span><span class="nf">/if</span><span class="cp">}</span><span class="x"></span>
<span class="x">                &lt;/h2&gt;</span>
<span class="x">            &lt;/header&gt;</span>

<span class="x">            </span><span class="cp">{</span><span class="nf">include</span> <span class="na">file</span><span class="o">=</span><span class="s1">&#39;__commentJavaScript&#39;</span> <span class="na">commentContainerID</span><span class="o">=</span><span class="s1">&#39;personCommentList&#39;</span><span class="cp">}</span><span class="x"></span>

<span class="x">            &lt;div class=&quot;personComments&quot;&gt;</span>
<span class="x">                &lt;ul id=&quot;personCommentList&quot; class=&quot;commentList containerList&quot; </span><span class="cp">{</span><span class="c">*</span>
<span class="c">                    *</span><span class="cp">}</span><span class="x">data-can-add=&quot;</span><span class="cp">{</span><span class="nf">if</span> <span class="nv">$commentCanAdd</span><span class="cp">}</span><span class="x">true</span><span class="cp">{</span><span class="nf">else</span><span class="cp">}</span><span class="x">false</span><span class="cp">{</span><span class="nf">/if</span><span class="cp">}</span><span class="x">&quot; </span><span class="cp">{</span><span class="c">*</span>
<span class="c">                    *</span><span class="cp">}</span><span class="x">data-object-id=&quot;</span><span class="cp">{</span><span class="o">@</span><span class="nv">$person</span><span class="o">-&gt;</span><span class="na">personID</span><span class="cp">}</span><span class="x">&quot; </span><span class="cp">{</span><span class="c">*</span>
<span class="c">                    *</span><span class="cp">}</span><span class="x">data-object-type-id=&quot;</span><span class="cp">{</span><span class="o">@</span><span class="nv">$commentObjectTypeID</span><span class="cp">}</span><span class="x">&quot; </span><span class="cp">{</span><span class="c">*</span>
<span class="c">                    *</span><span class="cp">}</span><span class="x">data-comments=&quot;</span><span class="cp">{</span><span class="nf">if</span> <span class="nv">$person</span><span class="o">-&gt;</span><span class="na">comments</span><span class="cp">}{</span><span class="o">@</span><span class="nv">$commentList</span><span class="o">-&gt;</span><span class="na">countObjects</span><span class="o">()</span><span class="cp">}{</span><span class="nf">else</span><span class="cp">}</span><span class="x">0</span><span class="cp">{</span><span class="nf">/if</span><span class="cp">}</span><span class="x">&quot; </span><span class="cp">{</span><span class="c">*</span>
<span class="c">                    *</span><span class="cp">}</span><span class="x">data-last-comment-time=&quot;</span><span class="cp">{</span><span class="o">@</span><span class="nv">$lastCommentTime</span><span class="cp">}</span><span class="x">&quot; </span><span class="cp">{</span><span class="c">*</span>
<span class="c">                *</span><span class="cp">}</span><span class="x">&gt;</span>
<span class="x">                    </span><span class="cp">{</span><span class="nf">include</span> <span class="na">file</span><span class="o">=</span><span class="s1">&#39;commentListAddComment&#39;</span> <span class="na">wysiwygSelector</span><span class="o">=</span><span class="s1">&#39;personCommentListAddComment&#39;</span><span class="cp">}</span><span class="x"></span>
<span class="x">                    </span><span class="cp">{</span><span class="nf">include</span> <span class="na">file</span><span class="o">=</span><span class="s1">&#39;commentList&#39;</span><span class="cp">}</span><span class="x"></span>
<span class="x">                &lt;/ul&gt;</span>
<span class="x">            &lt;/div&gt;</span>
<span class="x">        &lt;/section&gt;</span>
<span class="x">    </span><span class="cp">{</span><span class="nf">/if</span><span class="cp">}</span><span class="x"></span>
<span class="cp">{</span><span class="nf">/if</span><span class="cp">}</span><span class="x"></span>

<span class="x">&lt;footer class=&quot;contentFooter&quot;&gt;</span>
<span class="x">    </span><span class="cp">{</span><span class="nf">hascontent</span><span class="cp">}</span><span class="x"></span>
<span class="x">        &lt;nav class=&quot;contentFooterNavigation&quot;&gt;</span>
<span class="x">            &lt;ul&gt;</span>
<span class="x">                </span><span class="cp">{</span><span class="nf">content</span><span class="cp">}{</span><span class="nf">event</span> <span class="na">name</span><span class="o">=</span><span class="s1">&#39;contentFooterNavigation&#39;</span><span class="cp">}{</span><span class="nf">/content</span><span class="cp">}</span><span class="x"></span>
<span class="x">            &lt;/ul&gt;</span>
<span class="x">        &lt;/nav&gt;</span>
<span class="x">    </span><span class="cp">{</span><span class="nf">/hascontent</span><span class="cp">}</span><span class="x"></span>
<span class="x">&lt;/footer&gt;</span>

<span class="x">&lt;script data-relocate=&quot;true&quot;&gt;</span>
<span class="x">    require([&#39;Language&#39;, &#39;WoltLabSuite/Core/Controller/Person&#39;], (Language, ControllerPerson) =&gt; </span><span class="cp">{</span>
        <span class="na">Language</span><span class="o">.</span><span class="na">addObject</span><span class="o">(</span><span class="cp">{</span>
            <span class="s1">&#39;wcf.person.information.add&#39;</span><span class="o">:</span> <span class="s1">&#39;{jslang}wcf.person.information.add{/jslang}&#39;</span><span class="o">,</span>
            <span class="s1">&#39;wcf.person.information.add.success&#39;</span><span class="o">:</span> <span class="s1">&#39;{jslang}wcf.person.information.add.success{/jslang}&#39;</span><span class="o">,</span>
            <span class="s1">&#39;wcf.person.information.edit&#39;</span><span class="o">:</span> <span class="s1">&#39;{jslang}wcf.person.information.edit{/jslang}&#39;</span><span class="o">,</span>
            <span class="s1">&#39;wcf.person.information.edit.success&#39;</span><span class="o">:</span> <span class="s1">&#39;{jslang}wcf.person.information.edit.success{/jslang}&#39;</span><span class="o">,</span>
        <span class="cp">}</span><span class="o">);</span>

        <span class="na">ControllerPerson</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="cp">{</span><span class="o">@</span><span class="nv">$person</span><span class="o">-&gt;</span><span class="na">personID</span><span class="cp">}</span><span class="o">,</span> <span class="cp">{</span>
            <span class="na">canAddInformation</span><span class="o">:</span> <span class="cp">{</span><span class="na">if</span> <span class="nv">$__wcf</span><span class="o">-&gt;</span><span class="na">session</span><span class="o">-&gt;</span><span class="na">getPermission</span><span class="o">(</span><span class="s1">&#39;user.person.canAddInformation&#39;</span><span class="o">)</span><span class="cp">}</span><span class="kc">true</span><span class="cp">{</span><span class="na">else</span><span class="cp">}</span><span class="kc">false</span><span class="cp">{</span><span class="o">/</span><span class="na">if</span><span class="cp">}</span><span class="o">,</span>
        <span class="cp">}</span><span class="o">);</span>
    <span class="cp">}</span><span class="x">);</span>
<span class="x">&lt;/script&gt;</span>

<span class="cp">{</span><span class="nf">include</span> <span class="na">file</span><span class="o">=</span><span class="s1">&#39;footer&#39;</span><span class="cp">}</span><span class="x"></span>
</code></pre></div></td></tr></table></div>
<p>To keep things simple here, we reuse the structure and CSS classes used for comments.
Additionally, we always list all pieces of information.
If there are many pieces of information, a nicer solution would be a pagination or loading more pieces of information with JavaScript.</p>
<p>First, we note the <code>jsObjectActionContainer</code> class in combination with the <code>data-object-action-class-name</code> attribute, which are needed for the delete button for each piece of information, as explained <a href="../../../migration/wsc53/javascript/#wcfactiondelete-and-wcfactiontoggle">here</a>.
In <code>PersonInformationAction</code>, we have overridden the default implementations of <code>validateDelete()</code> and <code>delete()</code> which are called after clicking on a delete button.
In <code>validateDelete()</code>, we call <code>PersonInformation::canDelete()</code> on all pieces of information to be deleted for proper permission validation, and in <code>delete()</code>, we update the <code>informationCount</code> values of the people the deleted pieces of information belong to (see below).</p>
<p>The button to add a new piece of information, <code>#personInformationAddButton</code>, and the buttons to edit existing pieces of information, <code>.jsEditInformation</code>, are controlled with JavaScript code initialized at the very end of the template.</p>
<p>Lastly, in <code>create()</code> we provide default values for the <code>time</code>, <code>userID</code>, <code>username</code>, and <code>ipAddress</code> for cases like here when creating a new piece of information, where do not explicitly provide this data.
Additionally, we extract the information text from the <code>information_htmlInputProcessor</code> parameter provided by the associated WYSIWYG form field and update the number of pieces of information created for the relevant person.</p>
<h2 id="creating-and-editing-person-information">Creating and Editing Person Information<a class="headerlink" href="#creating-and-editing-person-information" title="Permanent link">#</a></h2>
<p>To create new pieces of information or editing existing ones, we do not add new form controllers but instead use dialogs generated by the form builder API so that the user does not have to leave the person page.</p>
<p>When clicking on the add button or on any of the edit buttons, a dialog opens with the relevant form:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">ts/WoltLabSuite/Core/Controller/Person.ts <a class="codeBoxTitleGitHubLink" href="https://github.com/WoltLab/docs.woltlab.com/tree/6.0/snippets/tutorial/tutorial-series/part-5/ts/WoltLabSuite/Core/Controller/Person.ts" title="View on GitHub"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8v2m9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1 0 1.71-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5Z"/></svg></span></a></span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span>
<span class="normal">99</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * Provides the JavaScript code for the person page.</span>
<span class="cm"> *</span>
<span class="cm"> * @author  Matthias Schmidt</span>
<span class="cm"> * @copyright  2001-2021 WoltLab GmbH</span>
<span class="cm"> * @license  GNU Lesser General Public License &lt;http://opensource.org/licenses/lgpl-license.php&gt;</span>
<span class="cm"> * @module  WoltLabSuite/Core/Controller/Person</span>
<span class="cm"> */</span><span class="w"></span>

<span class="k">import</span><span class="w"> </span><span class="nx">FormBuilderDialog</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;WoltLabSuite/Core/Form/Builder/Dialog&quot;</span><span class="p">;</span><span class="w"></span>
<span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">Language</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;WoltLabSuite/Core/Language&quot;</span><span class="p">;</span><span class="w"></span>
<span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">UiNotification</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;WoltLabSuite/Core/Ui/Notification&quot;</span><span class="p">;</span><span class="w"></span>

<span class="kd">let</span><span class="w"> </span><span class="nx">addDialog</span><span class="o">:</span><span class="w"> </span><span class="kt">FormBuilderDialog</span><span class="p">;</span><span class="w"></span>
<span class="kd">const</span><span class="w"> </span><span class="nx">editDialogs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Map</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">FormBuilderDialog</span><span class="o">&gt;</span><span class="p">();</span><span class="w"></span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">EditReturnValues</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nx">formattedInformation</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="nx">informationID</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">Options</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nx">canAddInformation</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="cm">/**</span>
<span class="cm"> * Opens the edit dialog after clicking on the edit button for a piece of information.</span>
<span class="cm"> */</span><span class="w"></span>
<span class="kd">function</span><span class="w"> </span><span class="nx">editInformation</span><span class="p">(</span><span class="nx">event</span><span class="o">:</span><span class="w"> </span><span class="kt">Event</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span><span class="w"></span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">currentTarget</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">currentTarget</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">HTMLElement</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">information</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">currentTarget</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="s2">&quot;.jsObjectActionObject&quot;</span><span class="p">)</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">HTMLElement</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">informationId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">information</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">objectId</span><span class="o">!</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">editDialogs</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">informationId</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nx">editDialogs</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="nx">informationId</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="ow">new</span><span class="w"> </span><span class="nx">FormBuilderDialog</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="sb">`personInformationEditDialog</span><span class="si">${</span><span class="nx">informationId</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;wcf\\data\\person\\information\\PersonInformationAction&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;getEditDialog&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="nx">actionParameters</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nx">informationID</span><span class="o">:</span><span class="w"> </span><span class="kt">informationId</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="p">},</span><span class="w"></span>
<span class="w">          </span><span class="nx">dialog</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="kt">Language.get</span><span class="p">(</span><span class="s2">&quot;wcf.person.information.edit&quot;</span><span class="p">),</span><span class="w"></span>
<span class="w">          </span><span class="p">},</span><span class="w"></span>
<span class="w">          </span><span class="nx">submitActionName</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;submitEditDialog&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nx">successCallback</span><span class="p">(</span><span class="nx">returnValues</span><span class="o">:</span><span class="w"> </span><span class="kt">EditReturnValues</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="sb">`personInformation</span><span class="si">${</span><span class="nx">returnValues</span><span class="p">.</span><span class="nx">informationID</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span><span class="o">!</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">              </span><span class="nx">returnValues</span><span class="p">.</span><span class="nx">formattedInformation</span><span class="p">;</span><span class="w"></span>

<span class="w">            </span><span class="nx">UiNotification</span><span class="p">.</span><span class="nx">show</span><span class="p">(</span><span class="nx">Language</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;wcf.person.information.edit.success&quot;</span><span class="p">));</span><span class="w"></span>
<span class="w">          </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">},</span><span class="w"></span>
<span class="w">      </span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="nx">editDialogs</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">informationId</span><span class="p">)</span><span class="o">!</span><span class="p">.</span><span class="nx">open</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="cm">/**</span>
<span class="cm"> * Initializes the JavaScript code for the person page.</span>
<span class="cm"> */</span><span class="w"></span>
<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">init</span><span class="p">(</span><span class="nx">personId</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">,</span><span class="w"> </span><span class="nx">options</span><span class="o">:</span><span class="w"> </span><span class="kt">Options</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">canAddInformation</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Initialize the dialog to add new information.</span><span class="w"></span>
<span class="w">    </span><span class="nx">addDialog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">FormBuilderDialog</span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;personInformationAddDialog&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;wcf\\data\\person\\information\\PersonInformationAction&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;getAddDialog&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nx">actionParameters</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="nx">personID</span><span class="o">:</span><span class="w"> </span><span class="kt">personId</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="nx">dialog</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="kt">Language.get</span><span class="p">(</span><span class="s2">&quot;wcf.person.information.add&quot;</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="nx">submitActionName</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;submitAddDialog&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nx">successCallback</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="nx">UiNotification</span><span class="p">.</span><span class="nx">show</span><span class="p">(</span><span class="nx">Language</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;wcf.person.information.add.success&quot;</span><span class="p">),</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">reload</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="p">},</span><span class="w"></span>
<span class="w">      </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;personInformationAddButton&quot;</span><span class="p">)</span><span class="o">!</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span><span class="w"></span>

<span class="w">      </span><span class="nx">addDialog</span><span class="p">.</span><span class="nx">open</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">});</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="nb">document</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s2">&quot;.jsEditInformation&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">el</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">el</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">ev</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">editInformation</span><span class="p">(</span><span class="nx">ev</span><span class="p">)));</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<p>We use the <a href="https://github.com/WoltLab/WCF/blob/master/ts/WoltLabSuite/Core/Form/Builder/Dialog.ts"><code>WoltLabSuite/Core/Form/Builder/Dialog</code> module</a>, which takes care of the internal handling with regard to these dialogs.
We only have to provide some data during for initializing these objects and call the <code>open()</code> function after a button has been clicked.</p>
<p>Explanation of the initialization arguments for <code>WoltLabSuite/Core/Form/Builder/Dialog</code> used here:</p>
<ul>
<li>The first argument is the id of the dialog used to identify it.</li>
<li>The second argument is the PHP class name which provides the contents of the dialog's form and handles the data after the form is submitted.</li>
<li>The third argument is the name of the method in the referenced PHP class in the previous argument that returns the dialog form.</li>
<li>The fourth argument contains additional options:<ul>
<li><code>actionParameters</code> are additional parameters send during each AJAX request.
  Here, we either pass the id of the person for who a new piece of information is added or the id of the edited piece of information.</li>
<li><code>dialog</code> contains the options for the dialog, see the <code>DialogOptions</code> interface.
  Here, we only provide the title of the dialog.</li>
<li><code>submitActionName</code> is the name of the method in the referenced PHP class that is called with the form data after submitting the form.</li>
<li><code>successCallback</code> is called after the submit AJAX request was successful.
  After adding a new piece of information, we reload the page, and after editing an existing piece of information, we update the existing information text with the updated text.
  (Dynamically inserting a newly added piece of information instead of reloading the page would also be possible, of course, but for this tutorial series, we kept things simple.)</li>
</ul>
</li>
</ul>
<p>Next, we focus on <code>PersonInformationAction</code>, which actually provides the contents of these dialogs and creates and edits the information:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">files/lib/data/person/information/PersonInformationAction.class.php <a class="codeBoxTitleGitHubLink" href="https://github.com/WoltLab/docs.woltlab.com/tree/6.0/snippets/tutorial/tutorial-series/part-5/files/lib/data/person/information/PersonInformationAction.class.php" title="View on GitHub"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8v2m9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1 0 1.71-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5Z"/></svg></span></a></span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">wcf\data\person\information</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">wcf\data\AbstractDatabaseObjectAction</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">wcf\data\person\PersonAction</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">wcf\data\person\PersonEditor</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">wcf\system\cache\runtime\PersonRuntimeCache</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">wcf\system\event\EventHandler</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">wcf\system\exception\IllegalLinkException</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">wcf\system\exception\PermissionDeniedException</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">wcf\system\exception\UserInputException</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">wcf\system\form\builder\container\wysiwyg\WysiwygFormContainer</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">wcf\system\form\builder\DialogFormDocument</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">wcf\system\html\input\HtmlInputProcessor</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">wcf\system\WCF</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">wcf\util\UserUtil</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * Executes person information-related actions.</span>
<span class="sd"> *</span>
<span class="sd"> * @author  Matthias Schmidt</span>
<span class="sd"> * @copyright   2001-2021 WoltLab GmbH</span>
<span class="sd"> * @license GNU Lesser General Public License &lt;http://opensource.org/licenses/lgpl-license.php&gt;</span>
<span class="sd"> * @package WoltLabSuite\Core\Data\Person\Information</span>
<span class="sd"> *</span>
<span class="sd"> * @method  PersonInformationEditor[]   getObjects()</span>
<span class="sd"> * @method  PersonInformationEditor     getSingleObject()</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">PersonInformationAction</span> <span class="k">extends</span> <span class="nx">AbstractDatabaseObjectAction</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @var DialogFormDocument</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="nv">$dialog</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @var PersonInformation</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="nv">$information</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @return  PersonInformation</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">create</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parameters</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;time&#39;</span><span class="p">]))</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parameters</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">TIME_NOW</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parameters</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;userID&#39;</span><span class="p">]))</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parameters</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;userID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">WCF</span><span class="o">::</span><span class="na">getUser</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">userID</span><span class="p">;</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parameters</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">WCF</span><span class="o">::</span><span class="na">getUser</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">username</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">LOG_IP_ADDRESS</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parameters</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;ipAddress&#39;</span><span class="p">]))</span> <span class="p">{</span>
                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parameters</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;ipAddress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">UserUtil</span><span class="o">::</span><span class="na">getIpAddress</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nb">unset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parameters</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;ipAddress&#39;</span><span class="p">]);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parameters</span><span class="p">[</span><span class="s1">&#39;information_htmlInputProcessor&#39;</span><span class="p">]))</span> <span class="p">{</span>
            <span class="sd">/** @var HtmlInputProcessor $htmlInputProcessor */</span>
            <span class="nv">$htmlInputProcessor</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parameters</span><span class="p">[</span><span class="s1">&#39;information_htmlInputProcessor&#39;</span><span class="p">];</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parameters</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;information&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$htmlInputProcessor</span><span class="o">-&gt;</span><span class="na">getHtml</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="sd">/** @var PersonInformation $information */</span>
        <span class="nv">$information</span> <span class="o">=</span> <span class="k">parent</span><span class="o">::</span><span class="na">create</span><span class="p">();</span>

        <span class="p">(</span><span class="k">new</span> <span class="nx">PersonAction</span><span class="p">([</span><span class="nv">$information</span><span class="o">-&gt;</span><span class="na">personID</span><span class="p">],</span> <span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;counters&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="s1">&#39;informationCount&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">]))</span><span class="o">-&gt;</span><span class="na">executeAction</span><span class="p">();</span>

        <span class="k">return</span> <span class="nv">$information</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @inheritDoc</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parameters</span><span class="p">[</span><span class="s1">&#39;information_htmlInputProcessor&#39;</span><span class="p">]))</span> <span class="p">{</span>
            <span class="sd">/** @var HtmlInputProcessor $htmlInputProcessor */</span>
            <span class="nv">$htmlInputProcessor</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parameters</span><span class="p">[</span><span class="s1">&#39;information_htmlInputProcessor&#39;</span><span class="p">];</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parameters</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;information&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$htmlInputProcessor</span><span class="o">-&gt;</span><span class="na">getHtml</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">parent</span><span class="o">::</span><span class="na">update</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @inheritDoc</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">validateDelete</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">objects</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">readObjects</span><span class="p">();</span>

            <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">objects</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nx">UserInputException</span><span class="p">(</span><span class="s1">&#39;objectIDs&#39;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getObjects</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$informationEditor</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$informationEditor</span><span class="o">-&gt;</span><span class="na">canDelete</span><span class="p">())</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nx">PermissionDeniedException</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @inheritDoc</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">delete</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$deleteCount</span> <span class="o">=</span> <span class="k">parent</span><span class="o">::</span><span class="na">delete</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$deleteCount</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$deleteCount</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nv">$counterUpdates</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getObjects</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$informationEditor</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$counterUpdates</span><span class="p">[</span><span class="nv">$informationEditor</span><span class="o">-&gt;</span><span class="na">personID</span><span class="p">]))</span> <span class="p">{</span>
                <span class="nv">$counterUpdates</span><span class="p">[</span><span class="nv">$informationEditor</span><span class="o">-&gt;</span><span class="na">personID</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="nv">$counterUpdates</span><span class="p">[</span><span class="nv">$informationEditor</span><span class="o">-&gt;</span><span class="na">personID</span><span class="p">]</span><span class="o">--</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nx">WCF</span><span class="o">::</span><span class="na">getDB</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">beginTransaction</span><span class="p">();</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$counterUpdates</span> <span class="k">as</span> <span class="nv">$personID</span> <span class="o">=&gt;</span> <span class="nv">$counterUpdate</span><span class="p">)</span> <span class="p">{</span>
            <span class="p">(</span><span class="k">new</span> <span class="nx">PersonEditor</span><span class="p">(</span><span class="nx">PersonRuntimeCache</span><span class="o">::</span><span class="na">getInstance</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getObject</span><span class="p">(</span><span class="nv">$personID</span><span class="p">)))</span><span class="o">-&gt;</span><span class="na">updateCounters</span><span class="p">([</span>
                <span class="s1">&#39;informationCount&#39;</span> <span class="o">=&gt;</span> <span class="nv">$counterUpdate</span><span class="p">,</span>
            <span class="p">]);</span>
        <span class="p">}</span>
        <span class="nx">WCF</span><span class="o">::</span><span class="na">getDB</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">commitTransaction</span><span class="p">();</span>

        <span class="k">return</span> <span class="nv">$deleteCount</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Validates the `getAddDialog` action.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">validateGetAddDialog</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nx">WCF</span><span class="o">::</span><span class="na">getSession</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">checkPermissions</span><span class="p">([</span><span class="s1">&#39;user.person.canAddInformation&#39;</span><span class="p">]);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">readInteger</span><span class="p">(</span><span class="s1">&#39;personID&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">PersonRuntimeCache</span><span class="o">::</span><span class="na">getInstance</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getObject</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parameters</span><span class="p">[</span><span class="s1">&#39;personID&#39;</span><span class="p">])</span> <span class="o">===</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">UserInputException</span><span class="p">(</span><span class="s1">&#39;personID&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Returns the data to show the dialog to add a new piece of information on a person.</span>
<span class="sd">     *</span>
<span class="sd">     * @return  string[]</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getAddDialog</span><span class="p">()</span><span class="o">:</span> <span class="k">array</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">buildDialog</span><span class="p">();</span>

        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">&#39;dialog&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dialog</span><span class="o">-&gt;</span><span class="na">getHtml</span><span class="p">(),</span>
            <span class="s1">&#39;formId&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dialog</span><span class="o">-&gt;</span><span class="na">getId</span><span class="p">(),</span>
        <span class="p">];</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Validates the `submitAddDialog` action.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">validateSubmitAddDialog</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">validateGetAddDialog</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">buildDialog</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dialog</span><span class="o">-&gt;</span><span class="na">requestData</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">??</span> <span class="p">[]);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dialog</span><span class="o">-&gt;</span><span class="na">readValues</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dialog</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Creates a new piece of information on a person after submitting the dialog.</span>
<span class="sd">     *</span>
<span class="sd">     * @return  string[]</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">submitAddDialog</span><span class="p">()</span><span class="o">:</span> <span class="k">array</span>
    <span class="p">{</span>
        <span class="c1">// If there are any validation errors, show the form again.</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dialog</span><span class="o">-&gt;</span><span class="na">hasValidationErrors</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="s1">&#39;dialog&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dialog</span><span class="o">-&gt;</span><span class="na">getHtml</span><span class="p">(),</span>
                <span class="s1">&#39;formId&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dialog</span><span class="o">-&gt;</span><span class="na">getId</span><span class="p">(),</span>
            <span class="p">];</span>
        <span class="p">}</span>

        <span class="p">(</span><span class="k">new</span> <span class="k">static</span><span class="p">([],</span> <span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="nx">\array_merge</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dialog</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">(),</span> <span class="p">[</span>
            <span class="s1">&#39;data&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="s1">&#39;personID&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parameters</span><span class="p">[</span><span class="s1">&#39;personID&#39;</span><span class="p">],</span>
            <span class="p">],</span>
        <span class="p">])))</span><span class="o">-&gt;</span><span class="na">executeAction</span><span class="p">();</span>

        <span class="k">return</span> <span class="p">[];</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Validates the `getEditDialog` action.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">validateGetEditDialog</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nx">WCF</span><span class="o">::</span><span class="na">getSession</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">checkPermissions</span><span class="p">([</span><span class="s1">&#39;user.person.canAddInformation&#39;</span><span class="p">]);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">readInteger</span><span class="p">(</span><span class="s1">&#39;informationID&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">information</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PersonInformation</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parameters</span><span class="p">[</span><span class="s1">&#39;informationID&#39;</span><span class="p">]);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">information</span><span class="o">-&gt;</span><span class="na">getObjectID</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">UserInputException</span><span class="p">(</span><span class="s1">&#39;informationID&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">information</span><span class="o">-&gt;</span><span class="na">canEdit</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">IllegalLinkException</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Returns the data to show the dialog to edit a piece of information on a person.</span>
<span class="sd">     *</span>
<span class="sd">     * @return  string[]</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getEditDialog</span><span class="p">()</span><span class="o">:</span> <span class="k">array</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">buildDialog</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dialog</span><span class="o">-&gt;</span><span class="na">updatedObject</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">information</span><span class="p">);</span>

        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">&#39;dialog&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dialog</span><span class="o">-&gt;</span><span class="na">getHtml</span><span class="p">(),</span>
            <span class="s1">&#39;formId&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dialog</span><span class="o">-&gt;</span><span class="na">getId</span><span class="p">(),</span>
        <span class="p">];</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Validates the `submitEditDialog` action.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">validateSubmitEditDialog</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">validateGetEditDialog</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">buildDialog</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dialog</span><span class="o">-&gt;</span><span class="na">updatedObject</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">information</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dialog</span><span class="o">-&gt;</span><span class="na">requestData</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">??</span> <span class="p">[]);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dialog</span><span class="o">-&gt;</span><span class="na">readValues</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dialog</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Updates a piece of information on a person after submitting the edit dialog.</span>
<span class="sd">     *</span>
<span class="sd">     * @return  string[]</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">submitEditDialog</span><span class="p">()</span><span class="o">:</span> <span class="k">array</span>
    <span class="p">{</span>
        <span class="c1">// If there are any validation errors, show the form again.</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dialog</span><span class="o">-&gt;</span><span class="na">hasValidationErrors</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="s1">&#39;dialog&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dialog</span><span class="o">-&gt;</span><span class="na">getHtml</span><span class="p">(),</span>
                <span class="s1">&#39;formId&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dialog</span><span class="o">-&gt;</span><span class="na">getId</span><span class="p">(),</span>
            <span class="p">];</span>
        <span class="p">}</span>

        <span class="p">(</span><span class="k">new</span> <span class="k">static</span><span class="p">([</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">information</span><span class="p">],</span> <span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dialog</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">()))</span><span class="o">-&gt;</span><span class="na">executeAction</span><span class="p">();</span>

        <span class="c1">// Reload the information with the updated data.</span>
        <span class="nv">$information</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PersonInformation</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">information</span><span class="o">-&gt;</span><span class="na">getObjectID</span><span class="p">());</span>

        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">&#39;formattedInformation&#39;</span> <span class="o">=&gt;</span> <span class="nv">$information</span><span class="o">-&gt;</span><span class="na">getFormattedInformation</span><span class="p">(),</span>
            <span class="s1">&#39;informationID&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">information</span><span class="o">-&gt;</span><span class="na">getObjectID</span><span class="p">(),</span>
        <span class="p">];</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Builds the dialog to create or edit person information.</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">buildDialog</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dialog</span> <span class="o">!==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dialog</span> <span class="o">=</span> <span class="nx">DialogFormDocument</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;personInformationAddDialog&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">appendChild</span><span class="p">(</span>
                <span class="nx">WysiwygFormContainer</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;information&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="na">messageObjectType</span><span class="p">(</span><span class="s1">&#39;com.woltlab.wcf.people.information&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="na">required</span><span class="p">()</span>
            <span class="p">);</span>

        <span class="nx">EventHandler</span><span class="o">::</span><span class="na">getInstance</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">fireAction</span><span class="p">(</span><span class="nv">$this</span><span class="p">,</span> <span class="s1">&#39;buildDialog&#39;</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dialog</span><span class="o">-&gt;</span><span class="na">build</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>When setting up the <code>WoltLabSuite/Core/Form/Builder/Dialog</code> object for adding new pieces of information, we specified <code>getAddDialog</code> and <code>submitAddDialog</code> as the names of the dialog getter and submit handler.
In addition to these two methods, the matching validation methods <code>validateGetAddDialog()</code> and <code>validateGetAddDialog()</code> are also added.
As the forms for adding and editing pieces of information have the same structure, this form is created in <code>buildDialog()</code> using a <code>DialogFormDocument</code> object, which is intended for forms in dialogs.
We fire an event in <code>buildDialog()</code> so that plugins are able to easily extend the dialog with additional data.</p>
<p><code>validateGetAddDialog()</code> checks if the user has the permission to create new pieces of information and if a valid id for the person, the information will belong to, is given. 
The method configured in the <code>WoltLabSuite/Core/Form/Builder/Dialog</code> object returning the dialog is expected to return two values:
the id of the form (<code>formId</code>) and the contents of form shown in the dialog (<code>dialog</code>).
This data is returned by <code>getAddDialog</code> using the dialog build previously by <code>buildDialog()</code>.</p>
<p>After the form is submitted, <code>validateSubmitAddDialog()</code> has to do the same basic validation as <code>validateGetAddDialog()</code> so that <code>validateGetAddDialog()</code> is simply called.
Additionally, the form data is read and validated.
In <code>submitAddDialog()</code>, we first check if there have been any validation errors:
If any error occured during validation, we return the same data as in <code>getAddDialog()</code> so that the dialog is shown again with the erroneous fields marked as such.
Otherwise, if the validation succeeded, the form data is used to create the new piece of information.
In addition to the form data, we manually add the id of the person to whom the information belongs to.
Lastly, we could return some data that we could access in the JavaScript callback function after successfully submitting the dialog.
As we will simply be reloading the page, no such data is returned.
An alternative to reloading to the page would be dynamically inserting the new piece of information in the list so that we would have to return the rendered list item for the new piece of information.</p>
<p>The process for getting and submitting the dialog to edit existing pieces of information is similar to the process for adding new pieces of information.
Instead of the id of the person, however, we now pass the id of the edited piece of information and in <code>submitEditDialog()</code>, we update the edited information instead of creating a new one like in <code>submitAddDialog()</code>.
After editing a piece of information, we do not reload the page but dynamically update the text of the information in the TypeScript code so that we return the updated rendered information text and id of the edited pieced of information in <code>submitAddDialog()</code>.</p>
<h2 id="rebuild-data-worker">Rebuild Data Worker<a class="headerlink" href="#rebuild-data-worker" title="Permanent link">#</a></h2>
<p>To ensure the integrity of the person data, <code>PersonRebuildDataWorker</code> updates the <code>informationCount</code> counter:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">files/lib/system/worker/PersonRebuildDataWorker.class.php <a class="codeBoxTitleGitHubLink" href="https://github.com/WoltLab/docs.woltlab.com/tree/6.0/snippets/tutorial/tutorial-series/part-5/files/lib/system/worker/PersonRebuildDataWorker.class.php" title="View on GitHub"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8v2m9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1 0 1.71-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5Z"/></svg></span></a></span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">wcf\system\worker</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">wcf\data\person\PersonList</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">wcf\system\WCF</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * Worker implementation for updating people.</span>
<span class="sd"> *</span>
<span class="sd"> * @author  Matthias Schmidt</span>
<span class="sd"> * @copyright   2001-2022 WoltLab GmbH</span>
<span class="sd"> * @license GNU Lesser General Public License &lt;http://opensource.org/licenses/lgpl-license.php&gt;</span>
<span class="sd"> * @package WoltLabSuite\Core\System\Worker</span>
<span class="sd"> *</span>
<span class="sd"> * @method  PersonList  getObjectList()</span>
<span class="sd"> */</span>
<span class="k">final</span> <span class="k">class</span> <span class="nc">PersonRebuildDataWorker</span> <span class="k">extends</span> <span class="nx">AbstractRebuildDataWorker</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @inheritDoc</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$limit</span> <span class="o">=</span> <span class="mi">500</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @inheritDoc</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$objectListClassName</span> <span class="o">=</span> <span class="nx">PersonList</span><span class="o">::</span><span class="na">class</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @inheritDoc</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">initObjectList</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">initObjectList</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">objectList</span><span class="o">-&gt;</span><span class="na">sqlOrderBy</span> <span class="o">=</span> <span class="s1">&#39;person.personID&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @inheritDoc</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">execute</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">execute</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">\count</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">objectList</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;UPDATE  wcf1_person person</span>
<span class="s2">                SET     informationCount = (</span>
<span class="s2">                            SELECT  COUNT(*)</span>
<span class="s2">                            FROM    wcf1_person_information person_information</span>
<span class="s2">                            WHERE   person_information.personID = person.personID</span>
<span class="s2">                        )</span>
<span class="s2">                WHERE   person.personID = ?&quot;</span><span class="p">;</span>
        <span class="nv">$statement</span> <span class="o">=</span> <span class="nx">WCF</span><span class="o">::</span><span class="na">getDB</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>

        <span class="nx">WCF</span><span class="o">::</span><span class="na">getDB</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">beginTransaction</span><span class="p">();</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getObjectList</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$person</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$statement</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">([</span><span class="nv">$person</span><span class="o">-&gt;</span><span class="na">personID</span><span class="p">]);</span>
        <span class="p">}</span>
        <span class="nx">WCF</span><span class="o">::</span><span class="na">getDB</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">commitTransaction</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="username-and-ip-address-event-listeners">Username and IP Address Event Listeners<a class="headerlink" href="#username-and-ip-address-event-listeners" title="Permanent link">#</a></h2>
<p>As we store the name of the user who create a new piece of information and store their IP address, we have to add event listeners to properly handle the following scenarios:</p>
<ol>
<li>If the user is renamed, the value of <code>username</code> stored with the person information has to be updated, which can be achieved by a simple event listener that only has to specify the name of relevant database table if <code>AbstractUserActionRenameListener</code> is extended:</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">files/lib/system/event/listener/PersonUserActionRenameListener.class.php <a class="codeBoxTitleGitHubLink" href="https://github.com/WoltLab/docs.woltlab.com/tree/6.0/snippets/tutorial/tutorial-series/part-5/files/lib/system/event/listener/PersonUserActionRenameListener.class.php" title="View on GitHub"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8v2m9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1 0 1.71-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5Z"/></svg></span></a></span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">wcf\system\event\listener</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * Updates person information during user renaming.</span>
<span class="sd"> *</span>
<span class="sd"> * @author  Matthias Schmidt</span>
<span class="sd"> * @copyright   2001-2022 WoltLab GmbH</span>
<span class="sd"> * @license GNU Lesser General Public License &lt;http://opensource.org/licenses/lgpl-license.php&gt;</span>
<span class="sd"> * @package WoltLabSuite\Core\System\Event\Listener</span>
<span class="sd"> */</span>
<span class="k">final</span> <span class="k">class</span> <span class="nc">PersonUserActionRenameListener</span> <span class="k">extends</span> <span class="nx">AbstractUserActionRenameListener</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @inheritDoc</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$databaseTables</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;wcf{WCF_N}_person_information&#39;</span><span class="p">,</span>
    <span class="p">];</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ol>
<li>If users are merged, all pieces of information need to be assigned to the target user of the merging.
  Again, we only have to specify the name of relevant database table if <code>AbstractUserMergeListener</code> is extended:</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">files/lib/system/event/listener/PersonUserMergeListener.class.php <a class="codeBoxTitleGitHubLink" href="https://github.com/WoltLab/docs.woltlab.com/tree/6.0/snippets/tutorial/tutorial-series/part-5/files/lib/system/event/listener/PersonUserMergeListener.class.php" title="View on GitHub"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8v2m9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1 0 1.71-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5Z"/></svg></span></a></span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">wcf\system\event\listener</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * Updates person information during user merging.</span>
<span class="sd"> *</span>
<span class="sd"> * @author  Matthias Schmidt</span>
<span class="sd"> * @copyright   2001-2022 WoltLab GmbH</span>
<span class="sd"> * @license GNU Lesser General Public License &lt;http://opensource.org/licenses/lgpl-license.php&gt;</span>
<span class="sd"> * @package WoltLabSuite\Core\System\Event\Listener</span>
<span class="sd"> */</span>
<span class="k">final</span> <span class="k">class</span> <span class="nc">PersonUserMergeListener</span> <span class="k">extends</span> <span class="nx">AbstractUserMergeListener</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @inheritDoc</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$databaseTables</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;wcf{WCF_N}_person_information&#39;</span><span class="p">,</span>
    <span class="p">];</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ol>
<li>If the option to prune stored ip addresses after a certain period of time is enabled, we also have to prune them in the person information database table.
  Here we also only have to specify the name of the relevant database table and provide the mapping from the <code>ipAddress</code> column to the <code>time</code> column:</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">files/lib/system/event/listener/PersonPruneIpAddressesCronjobListener.class.php <a class="codeBoxTitleGitHubLink" href="https://github.com/WoltLab/docs.woltlab.com/tree/6.0/snippets/tutorial/tutorial-series/part-5/files/lib/system/event/listener/PersonPruneIpAddressesCronjobListener.class.php" title="View on GitHub"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8v2m9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1 0 1.71-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5Z"/></svg></span></a></span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">wcf\system\event\listener</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">wcf\system\cronjob\PruneIpAddressesCronjob</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * Prunes old ip addresses.</span>
<span class="sd"> *</span>
<span class="sd"> * @author  Matthias Schmidt</span>
<span class="sd"> * @copyright   2001-2022 WoltLab GmbH</span>
<span class="sd"> * @license GNU Lesser General Public License &lt;http://opensource.org/licenses/lgpl-license.php&gt;</span>
<span class="sd"> * @package WoltLabSuite\Core\System\Event\Listener</span>
<span class="sd"> */</span>
<span class="k">final</span> <span class="k">class</span> <span class="nc">PersonPruneIpAddressesCronjobListener</span> <span class="k">extends</span> <span class="nx">AbstractEventListener</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">onExecute</span><span class="p">(</span><span class="nx">PruneIpAddressesCronjob</span> <span class="nv">$cronjob</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$cronjob</span><span class="o">-&gt;</span><span class="na">columns</span><span class="p">[</span><span class="s1">&#39;wcf&#39;</span> <span class="o">.</span> <span class="nx">WCF_N</span> <span class="o">.</span> <span class="s1">&#39;_person_information&#39;</span><span class="p">][</span><span class="s1">&#39;ipAddress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;time&#39;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ol>
<li>The ip addresses in the person information database table also have to be considered for the user data export which can also be done with minimal effort by providing the name of the relevant database table:</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">files/lib/system/event/listener/PersonUserExportGdprListener.class.php <a class="codeBoxTitleGitHubLink" href="https://github.com/WoltLab/docs.woltlab.com/tree/6.0/snippets/tutorial/tutorial-series/part-5/files/lib/system/event/listener/PersonUserExportGdprListener.class.php" title="View on GitHub"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8v2m9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1 0 1.71-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5Z"/></svg></span></a></span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">wcf\system\event\listener</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">wcf\acp\action\UserExportGdprAction</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * Adds the ip addresses stored with the person information during user data export.</span>
<span class="sd"> *</span>
<span class="sd"> * @author  Matthias Schmidt</span>
<span class="sd"> * @copyright   2001-2022 WoltLab GmbH</span>
<span class="sd"> * @license GNU Lesser General Public License &lt;http://opensource.org/licenses/lgpl-license.php&gt;</span>
<span class="sd"> * @package WoltLabSuite\Core\System\Event\Listener</span>
<span class="sd"> */</span>
<span class="k">final</span> <span class="k">class</span> <span class="nc">PersonUserExportGdprListener</span> <span class="k">extends</span> <span class="nx">AbstractEventListener</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">onExport</span><span class="p">(</span><span class="nx">UserExportGdprAction</span> <span class="nv">$action</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$action</span><span class="o">-&gt;</span><span class="na">ipAddresses</span><span class="p">[</span><span class="s1">&#39;com.woltlab.wcf.people&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;wcf&#39;</span> <span class="o">.</span> <span class="nx">WCF_N</span> <span class="o">.</span> <span class="s1">&#39;_person_information&#39;</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Lastly, we present the updated <code>eventListener.xml</code> file with new entries for all of these event listeners:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">eventListener.xml <a class="codeBoxTitleGitHubLink" href="https://github.com/WoltLab/docs.woltlab.com/tree/6.0/snippets/tutorial/tutorial-series/part-5/eventListener.xml" title="View on GitHub"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8v2m9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1 0 1.71-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5Z"/></svg></span></a></span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;data</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.woltlab.com&quot;</span> <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.woltlab.com http://www.woltlab.com/XSD/5.4/eventListener.xsd&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;import&gt;</span>
        <span class="nt">&lt;eventlistener</span> <span class="na">name=</span><span class="s">&quot;rename@wcf\data\user\UserAction&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;eventclassname&gt;</span>wcf\data\user\UserAction<span class="nt">&lt;/eventclassname&gt;</span>
            <span class="nt">&lt;eventname&gt;</span>rename<span class="nt">&lt;/eventname&gt;</span>
            <span class="nt">&lt;listenerclassname&gt;</span>wcf\system\event\listener\PersonUserActionRenameListener<span class="nt">&lt;/listenerclassname&gt;</span>
            <span class="nt">&lt;environment&gt;</span>all<span class="nt">&lt;/environment&gt;</span>
        <span class="nt">&lt;/eventlistener&gt;</span>
        <span class="nt">&lt;eventlistener</span> <span class="na">name=</span><span class="s">&quot;save@wcf\acp\form\UserMergeForm&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;eventclassname&gt;</span>wcf\acp\form\UserMergeForm<span class="nt">&lt;/eventclassname&gt;</span>
            <span class="nt">&lt;eventname&gt;</span>save<span class="nt">&lt;/eventname&gt;</span>
            <span class="nt">&lt;listenerclassname&gt;</span>wcf\system\event\listener\PersonUserMergeListener<span class="nt">&lt;/listenerclassname&gt;</span>
            <span class="nt">&lt;environment&gt;</span>admin<span class="nt">&lt;/environment&gt;</span>
        <span class="nt">&lt;/eventlistener&gt;</span>
        <span class="nt">&lt;eventlistener</span> <span class="na">name=</span><span class="s">&quot;execute@wcf\system\cronjob\PruneIpAddressesCronjob&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;eventclassname&gt;</span>wcf\system\cronjob\PruneIpAddressesCronjob<span class="nt">&lt;/eventclassname&gt;</span>
            <span class="nt">&lt;eventname&gt;</span>execute<span class="nt">&lt;/eventname&gt;</span>
            <span class="nt">&lt;listenerclassname&gt;</span>wcf\system\event\listener\PersonPruneIpAddressesCronjobListener<span class="nt">&lt;/listenerclassname&gt;</span>
            <span class="nt">&lt;environment&gt;</span>all<span class="nt">&lt;/environment&gt;</span>
        <span class="nt">&lt;/eventlistener&gt;</span>
        <span class="nt">&lt;eventlistener</span> <span class="na">name=</span><span class="s">&quot;export@wcf\acp\action\UserExportGdprAction&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;eventclassname&gt;</span>wcf\acp\action\UserExportGdprAction<span class="nt">&lt;/eventclassname&gt;</span>
            <span class="nt">&lt;eventname&gt;</span>export<span class="nt">&lt;/eventname&gt;</span>
            <span class="nt">&lt;listenerclassname&gt;</span>wcf\system\event\listener\PersonUserExportGdprListener<span class="nt">&lt;/listenerclassname&gt;</span>
            <span class="nt">&lt;environment&gt;</span>admin<span class="nt">&lt;/environment&gt;</span>
        <span class="nt">&lt;/eventlistener&gt;</span>
    <span class="nt">&lt;/import&gt;</span>
<span class="nt">&lt;/data&gt;</span>
</code></pre></div></td></tr></table></div>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      2021-05-03
    
  </small>
</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../part_4/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Part 4" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Part 4
            </div>
          </div>
        </a>
      
      
        
        <a href="../part_6/" class="md-footer__link md-footer__link--next" aria-label="Next: Part 6" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Part 6
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright  2020 WoltLab GmbH
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-copyright">
	<a href="https://www.woltlab.com/legal-notice/">Legal Notice</a> 
	<a href="https://www.woltlab.com/privacy-policy/">Privacy Policy</a>
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tracking"], "search": "../../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
    
    
  </body>
</html>